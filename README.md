# いま世界で寝ているのは何%？

各日本時間に世界の何割が寝ているか計算するスクリプトです。

tl:dr;

- 日本時間 7 時に世界の 74%が寝ています
- 日本時間 22 時に世界の 3%が寝ています

![人口グラフ](rsrc/sleeping_population.png)

もともと[こちらのツイート](https://twitter.com/sobsin/status/1369397843350478852)で問われていた「歴史的に一番人が寝ていた瞬間っていつだったのかな」がとても面白い疑問だと思い、「歴史的に」の部分は飛ばして「日々、一番人が寝ている時間はいつだろう」を計算してみることにしました。

# 方法

計算において２つの単純化をしています：

- 人は（自分の現地時間の）22 時から 6 時の間に寝る
  - -> 大きく傾向の違いが出るほど乱暴ではないと考えています。
- 時間帯（UTC からのズレ）は経度に線形にふるまう
  - -> 場所によって数時間ずれますが、やはり傾向の違いが出るほど乱暴ではないと思います。こちらはその気になれば座標毎の時間帯マップを使ってより精緻に計算できますが、面倒くさかったのでやってません。

まず、[SEDEC の公開している、座標ごとの推定人口データ](https://beta.sedac.ciesin.columbia.edu/data/set/gpw-v4-population-count/data-download)を使い、経度毎の推定人口を算出します。
![経度毎の人口](rsrc/population_per_longitude.png)
次に、ある（日本の）時刻において、各軽度が寝ているか否かを上記仮定に基づき判定し、寝ている人口をプロットします。

# 結果と考察

上記 t:dr;にあまり追記することはありませんが、少し妥当性について語ります。
日本時間の朝７時には世界の 74%が寝ているというのは驚きの結果です。簡単な検算をしてみましょう：

- [Wikipedia によると](https://en.wikipedia.org/wiki/List_of_continents_by_population)、アジア＋アフリカ＋ヨーロッパで全人口の 86%が占められています。
- 日本時間 7 時には、
  - UTC+8（北京とか）が６時です。
  - UTC+0（イギリスとか）が 22 時です。
- なので、日本時間 7 時にヨーロッパ、アフリカ、アジアの大半は寝ているということになり、74%が寝ているというのは結構妥当っぽいです。

# 実行する

まずコードを用意：

```
git clone https://github.com/kenkawakenkenke/sleeping_population.git
npm install
```

その間に SEDEC のサイトで Gridded Population of the World (GPW), v4 2020 データをダウンロードしてください：
https://beta.sedac.ciesin.columbia.edu/data/set/gpw-v4-population-count/data-download

この中の gpw-v4-population-count_2020.tif を"data"フォルダに置いてください。

最後に、スクリプトを実行：

```
node src/index.js
```

すると、結果が出てきます：

```
 0:00  9:00 4363479286.312379 0.5446038772262918
 1:00 10:00 3148818571.495159 0.3930026224938636
 2:00 11:00 2747465974.7750688 0.3429099863275248
 3:00 12:00 2748184118.2527204 0.3429996174903358
 ...
```

結構衝撃的な結果だったので、ぜひコードをよく読んで追試していただけると助かります。
